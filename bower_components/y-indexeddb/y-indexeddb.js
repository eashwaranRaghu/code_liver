/**
 * yjs - A framework for real-time p2p shared editing on any data
 * @version v12.1.3
 * @link http://y-js.org
 * @license MIT
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.yIndexeddb=e()}}(function(){return function e(t,r,n){function o(i,u){if(!r[i]){if(!t[i]){var s="function"==typeof require&&require;if(!u&&s)return s(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[i]={exports:{}};t[i][0].call(l.exports,function(e){var r=t[i][1][e];return o(r?r:e)},l,l.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,i)}function u(e){e.requestModules(["memory"]).then(function(){function t(e){var t=function(e){function t(){a(this,t);var e=n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.buffer=[],e._copyTo=null,e}return o(t,e),c(t,[{key:"copyTo",value:function(e){return this._copyTo=e,this}},{key:"put",value:regeneratorRuntime.mark(function e(r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n||this.buffer.push(this._copyTo.put(r)),e.delegateYield(s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"put",this).call(this,r),"t0",2);case 2:case"end":return e.stop()}},e,this)})},{key:"delete",value:regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.buffer.push(this._copyTo.delete(r)),e.delegateYield(s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this,r),"t0",2);case 2:case"end":return e.stop()}},e,this)})},{key:"flush",value:regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"flush",this).call(this),"t0",1);case 1:r=0;case 2:if(!(r<this.buffer.length)){e.next=7;break}return e.delegateYield(this.buffer[r],"t1",4);case 4:r++,e.next=2;break;case 7:return e.delegateYield(this._copyTo.flush(),"t2",8);case 8:case"end":return e.stop()}},e,this)})}]),t}(e);return t}var r=function(){function e(t,r){a(this,e),this.store=t.objectStore(r)}return c(e,[{key:"find",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.get(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})},{key:"put",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.put(t);case 2:case"end":return e.stop()}},e,this)})},{key:"delete",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.delete(t);case 2:case"end":return e.stop()}},e,this)})},{key:"findWithLowerBound",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.openCursor(IDBKeyRange.lowerBound(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})},{key:"findWithUpperBound",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.openCursor(IDBKeyRange.upperBound(t),"prev");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})},{key:"findNext",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.findWithLowerBound([t[0],t[1]+1]),"t0",1);case 1:return e.abrupt("return",e.t0);case 2:case"end":return e.stop()}},e,this)})},{key:"findPrev",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.findWithUpperBound([t[0],t[1]-1]),"t0",1);case 1:return e.abrupt("return",e.t0);case 2:case"end":return e.stop()}},e,this)})},{key:"iterate",value:regeneratorRuntime.mark(function e(t,r,n,o){var a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=null,null!=r&&null!=n?a=IDBKeyRange.bound(r,n):null!=r?a=IDBKeyRange.lowerBound(r):null!=n&&(a=IDBKeyRange.upperBound(n)),i=null!=a?this.store.openCursor(a):this.store.openCursor();case 3:return e.next=5,i;case 5:if(e.t0=e.sent,null==e.t0){e.next=11;break}return e.delegateYield(o.call(t,i.result.value),"t1",8);case 8:i.result.continue(),e.next=3;break;case 11:case"end":return e.stop()}},e,this)})},{key:"flush",value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)})}]),e}();e.utils.createStoreClone=t;var u=e.utils.createSmallLookupBuffer(r),l=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=e.db.transaction(["OperationStore","StateStore","DeleteStore"],"readwrite");return r.store=e,r.ss=new u(o,"StateStore"),r.os=new u(o,"OperationStore"),r.ds=new u(o,"DeleteStore"),r}return o(t,e),t}(e.Transaction),p=function(t){function r(t,o){a(this,r),null==o.gc&&(o.gc=!1);var u=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,o));if(null==o&&(o={}),u.options=o,null==o.namespace){if(null==t.options.connector.room)throw new Error("IndexedDB: expect a string (options.namespace)! (you can also skip this step if your connector has a room property)");o.namespace=t.options.connector.room}null!=o.idbVersion?u.idbVersion=o.idbVersion:u.idbVersion=5;var s=u;u.requestTransaction(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,indexedDB.open(o.namespace,s.idbVersion);case 2:s.db=e.sent;case 3:case"end":return e.stop()}},e,this)})),o.cleanStart&&("undefined"!=typeof localStorage&&delete localStorage[JSON.stringify(["Yjs_indexeddb",o.namespace])],u.requestTransaction(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.os.store.clear();case 2:return e.next=4,this.ds.store.clear();case 4:return e.next=6,this.ss.store.clear();case 6:case"end":return e.stop()}},e,this)}))),u.whenUserIdSet(function(e){"undefined"!=typeof localStorage&&null==localStorage[JSON.stringify(["Yjs_indexeddb",o.namespace])]&&(localStorage[JSON.stringify(["Yjs_indexeddb",o.namespace])]=JSON.stringify([e,0]))}),u.requestTransaction(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=null,"undefined"!=typeof localStorage&&(t=localStorage[JSON.stringify(["Yjs_indexeddb",o.namespace])]),null!=t?(s.setUserId(t),"undefined"!=typeof localStorage&&(r=JSON.parse(t),r[1]=r[1]+1,localStorage[JSON.stringify(["Yjs_indexeddb",o.namespace])]=JSON.stringify(r))):setTimeout(function(){null==s.userId&&s.setUserId(i())},200);case 3:case"end":return e.stop()}},e,this)}));var c=[];return u.communicationObserver=function(t){c.push(t),1===c.length&&s.requestTransaction(regeneratorRuntime.mark(function t(){var r,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(r=[],n=0;n<c.length;n++)o=c[n],(null==o.parent||c.every(function(t){return!e.utils.compareIds(t.id,o.parent)}))&&r.push(o);c=[],n=0;case 4:if(!(n<r.length)){t.next=9;break}return t.delegateYield(this.store.operationAdded(this,r[n],!0),"t0",6);case 6:n++,t.next=4;break;case 9:case"end":return t.stop()}},t,this)}))},e.utils.localCommunication.addObserver(u.options.namespace,u.communicationObserver),u}return o(r,t),c(r,[{key:"operationAdded",value:regeneratorRuntime.mark(function t(n,o,a){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"operationAdded",this).call(this,n,o),"t0",1);case 1:a||e.utils.localCommunication.broadcast(this.options.namespace,o);case 2:case"end":return t.stop()}},t,this)})},{key:"transact",value:function(e){function t(a){var i=a.value;return a.done?(e=n.getNextRequest(),void(null!=e&&(null==r&&null!=n.db&&(r=new l(n)),o=e.call(r),t(o.next())))):void(i.constructor===IDBRequest?(i.onsuccess=function(){var e=i.result;null!=e&&e.constructor===IDBCursorWithValue&&(e=e.value),t(o.next(e))},i.onerror=function(e){o.throw(e)}):i.constructor===IDBCursor?(i.onsuccess=function(){t(o.next(null!=i.result?i.result.value:null))},i.onerror=function(e){o.throw(e)}):i.constructor===IDBOpenDBRequest?(i.onsuccess=function(e){var r=e.target.result;t(o.next(r))},i.onerror=function(){o.throw("Couldn't open IndexedDB database!")},i.onupgradeneeded=function(e){var t=e.target.result;"undefined"!=typeof localStorage&&delete localStorage[JSON.stringify(["Yjs_indexeddb",n.options.namespace])],t.objectStoreNames.contains("OperationStore")&&(t.deleteObjectStore("OperationStore"),t.deleteObjectStore("DeleteStore"),t.deleteObjectStore("StateStore")),t.createObjectStore("OperationStore",{keyPath:"id"}),t.createObjectStore("DeleteStore",{keyPath:"id"}),t.createObjectStore("StateStore",{keyPath:"id"})}):o.throw("You must not yield this type!"))}var r=null!=this.db?new l(this):null,n=this,o=e.call(r);t(o.next())}},{key:"destroy",value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.db.close();case 1:case"end":return e.stop()}},e,this)})},{key:"deleteDB",value:function(){return e.utils.localCommunication.removeObserver(this.options.namespace,this.communicationObserver),indexedDB.deleteDatabase(this.options.namespace),Promise.resolve()}}]),r}(e.AbstractDatabase);null==e.utils.localCommunication&&(e.utils.localCommunication={observer:{},addObserver:function(e,t){var r=this.observer[e];null==r&&(r=[],this.observer[e]=r),r.push(t)},removeObserver:function(e,t){this.observer[e]=this.observer[e].filter(function(e){return t!==e})},broadcast:function(e,t){"undefined"!=typeof localStorage&&localStorage.setItem(JSON.stringify(["__YJS__",e]),JSON.stringify(t)),this.observer[e].map(function(e){e(t)})}},"undefined"!=typeof localStorage&&addEventListener("storage",function(t){var r;try{var n=JSON.parse(t.key);if("__YJS__"!==n[0])return;r=n[1]}catch(e){return}var o=e.utils.localCommunication.observer[r];null!=o&&o.map(function(e){e(JSON.parse(t.newValue))})})),e.extend("indexeddb",p)})}var s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in o)return o.value;var i=o.get;if(void 0!==i)return i.call(n)},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.exports=u,"undefined"!=typeof Y&&u(Y)},{}]},{},[1])(1)});
//# sourceMappingURL=y-indexeddb.js.map
