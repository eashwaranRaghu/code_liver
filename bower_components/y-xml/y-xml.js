!function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return o(n?n:e)},d,d.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){e.requestModules(["Array","Map"]).then(function(){var t=function(t){function n(t,i,a,s,l,d){r(this,n);var c=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,i,a));return c.attributes=s,c.dom=null,c._domObserver=null,c._eventListenerHandler=new e.utils.EventListenerHandler,c.tagname=l,null!=d&&null!=d.dom&&c._setDom(d.dom),u(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"observe",c).call(c,function(e){"insert"===e.type?c._eventListenerHandler.callEventListeners({type:"childInserted",index:e.index,nodes:e.values}):"delete"===e.type&&c._eventListenerHandler.callEventListeners({type:"childRemoved",index:e.index,_content:e._content,values:e.values})}),s.observe(function(e){"update"===e.type||"add"===e.type?c._eventListenerHandler.callEventListeners({type:"attributeChanged",name:e.name,value:e.value}):"delete"===e.type&&c._eventListenerHandler.callEventListeners({type:"attributeRemoved",name:e.name})}),c}return i(n,t),s(n,[{key:"_destroy",value:function(){null!=this._domObserver&&this._domObserver.disconnect(),this._eventListenerHandler.destroy(),this._eventListenerHandler=null,u(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_destroy",this).call(this)}},{key:"insert",value:function(t,r){var o=[];if(!Array.isArray(r))throw new Error("Expected an Array of content!");for(var i=0;i<r.length;i++){var a=r[i],s=e.utils.isTypeDefinition(a);if(null==a||!("string"==typeof a||s&&s[0].class===n))throw new Error("Expected Y.Xml type or String!");"string"==typeof a&&0===a.length||o.push(a)}u(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"insert",this).call(this,t,r)}},{key:"_bindToDom",value:function(t){var r=this,o=!0,i=function(e){var t=r._domObserver.takeRecords();if(t.length>0&&r._domObserverListener(t),o){o=!1;try{e()}catch(e){throw r._domObserver.takeRecords(),o=!0,e}r._domObserver.takeRecords(),o=!0}};this._mutualExclude=i,this._domObserverListener=function(t){i(function(){t.forEach(function(t){if("attributes"===t.type){var n=t.attributeName,o=t.target.getAttribute(t.attributeName);r.attributes.get(n)!==o&&r.attributes.set(n,o)}else if("childList"===t.type){for(var i=function(n){var o=t.addedNodes[n];if(r._content.some(function(e){return e.dom===o}))return"continue";if(o instanceof window.Text&&""===o.textContent)return o.remove(),"continue";for(s=-1,u=o.nextSibling;s<0;)null==u?s=r._content.length:(s=r._content.findIndex(function(e){return e.dom===u}),u=u.nextSibling);if(o instanceof window.Text)l=o.textContent;else{if(!(o instanceof window.Element))throw new Error("Unsupported XML Element found. Synchronization will no longer work!");l=e.Xml(o)}r.insert(s,[l]),d=r._content[s],d.dom=o},a=0;a<t.addedNodes.length;a++){var s,u,l,d;i(a)}Array.prototype.forEach.call(t.removedNodes,function(e){var t=r._content.findIndex(function(t){return t.dom===e});if(!(t>=0))throw new Error("An unexpected condition occured (deleted node does not exist in the model)!");r.delete(t)})}})})},this._domObserver=new MutationObserver(this._domObserverListener),this._domObserver.observe(t,{attributes:!0,childList:!0});var a=function(e){var n,o=r._content[e];if(e+1<r._content.length){if(n=r._content[e+1],null==n.dom)throw new Error("Unexpected behavior")}else n={dom:null};t.insertBefore(o.dom,n.dom)};return this._tryInsertDom=a,this.observe(function(o){i(function(){if("attributeChanged"===o.type)t.setAttribute(o.name,o.value);else if("attributeRemoved"===o.type)t.removeAttribute(o.name);else if("childInserted"===o.type)if(1===o.nodes.length&&o.nodes[0]instanceof n){var i=r._content[o.index].id;if(o.nodes.length>1)throw new Error("This case is not handled, you'll run into consistency issues. Contact the developer");var s,u=o.nodes[0].getDom();s=o.index<r._content.length&&e.utils.compareIds(r._content[o.index].id,i)?o.index:r._content.findIndex(function(t){return e.utils.compareIds(t.id,i)}),s>=0&&(r._content[s].dom=u,a(s))}else for(var l=o.nodes.length-1;l>=0;l--){var d=o.nodes[l],c=new window.Text(d);r._content[o.index+l].dom=c,a(o.index+l)}else"childRemoved"===o.type&&o._content.forEach(function(e){null!=e.dom&&e.dom.remove()})})}),t}},{key:"_setDom",value:function(t){var n=this;if(null!=this.dom)throw new Error("Only call this method if you know what you are doing ;)");if(null!=t.__yxml)throw new Error("Already bound to an YXml type");t.__yxml=this._model;for(var r=0;r<t.attributes.length;r++){var o=t.attributes[r];this.attributes.set(o.name,o.value)}return this.insert(0,Array.prototype.map.call(t.childNodes,function(t,n){if(t instanceof window.Element)return e.Xml(t);if(t instanceof window.Text)return t.textContent;throw new Error("Unknown node type!")})),Array.prototype.forEach.call(t.childNodes,function(e,t){var r=n._content[t];r.dom=e}),this.dom=this._bindToDom(t),this.dom}},{key:"getDom",value:function(){var e=this;if(null==this.dom){var t=document.createElement(this.tagname);t.__yxml=this,this.attributes.keysPrimitives().forEach(function(n){t.setAttribute(n,e.attributes.get(n))});for(var n=0;n<this._content.length;n++){var r=this._content[n];r.hasOwnProperty("val")?r.dom=new window.Text(r.val):r.dom=this.os.getType(r.type).getDom(),t.appendChild(r.dom)}this.dom=this._bindToDom(t)}return this.dom}},{key:"observe",value:function(e){this._eventListenerHandler.addEventListener(e)}},{key:"unobserve",value:function(e){this._eventListenerHandler.removeEventListener(e)}},{key:"_changed",value:regeneratorRuntime.mark(function t(){var n=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return null!=this._domObserver&&this._domObserverListener(this._domObserver.takeRecords()),t.delegateYield(e.Array.typeDefinition.class.prototype._changed.apply(this,n),"t0",2);case 2:case"end":return t.stop()}},t,this)})}]),n}(e.Array.typeDefinition.class);e.extend("Xml",new e.utils.CustomTypeDefinition({name:"Xml",class:t,struct:"List",parseArguments:function(e){if("string"==typeof e)return[this,{tagname:e}];if(e instanceof window.Element)return[this,{tagname:e.tagName,dom:e}];throw new Error("Y.Xml requires an argument which is a string!")},initType:regeneratorRuntime.mark(function n(r,o,i){var a,s,u,l,d,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=[],s=[],n.delegateYield(e.Struct.List.map.call(this,o,function(e){e.hasOwnProperty("opContent")?(a.push({id:e.id,type:e.opContent}),s.push(e.opContent)):e.content.forEach(function(t,n){a.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})}),"t0",3);case 3:u=0;case 4:if(!(u<s.length)){n.next=9;break}return n.delegateYield(r.initType.call(this,s[u]),"t1",6);case 6:u++,n.next=4;break;case 9:if("_"!==o.id[0]){n.next=19;break}return d=e.Map.typeDefinition.struct,c=["_",d+"_Map_"+o.id[1]],n.delegateYield(r.initType.call(this,c),"t2",13);case 13:return l=n.t2,o.requires=[l._model],o.info={tagname:i.tagname},n.delegateYield(this.setOperation(o),"t3",17);case 17:n.next=21;break;case 19:return n.delegateYield(r.initType.call(this,o.requires[0]),"t4",20);case 20:l=n.t4;case 21:return n.abrupt("return",new t(r,o.id,a,l,o.info.tagname,o.info));case 22:case"end":return n.stop()}},n,this)}),createType:function(n,r,o){var i=null;if("_"===r.id[0]){var a=e.Map.typeDefinition.struct;i=["_",a+"_Map_"+r.id[1]]}var s=n.createType(e.Map(),i);return r.info={tagname:o.tagname},r.requires=[s._model],new t(n,r.id,[],s,r.info.tagname,o)}}))})}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)};t.exports=a,"undefined"!=typeof Y&&a(Y)},{}]},{},[1]);
//# sourceMappingURL=y-xml.js.map
